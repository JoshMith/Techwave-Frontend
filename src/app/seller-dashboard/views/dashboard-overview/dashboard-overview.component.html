<!-- dashboard-overview.component.html -->

<div *ngIf="isLoading" class="loading-container">
  <div class="loading-spinner"></div>
  <p>Loading dashboard data...</p>
</div>

<div *ngIf="error && !isLoading" class="error-container">
  <div class="error-message">
    <span class="error-icon">‚ö†Ô∏è</span>
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="load()">Retry</button>
  </div>
</div>

<div *ngIf="!isLoading && !error">

  <!-- Header -->
  <div class="dashboard-header">
    <h1 class="dashboard-title">Welcome back, {{ auth.userName }}!</h1>
    <p class="dashboard-subtitle">Here's what's happening with your store today</p>
    <button class="refresh-btn" (click)="load()" title="Refresh Data">üîÑ Refresh</button>
  </div>

  <!-- Stats Grid -->
  <div class="stats-grid">
    <div class="stat-card" *ngFor="let stat of stats">
      <div class="stat-header">
        <div>
          <div class="stat-title">{{ stat.title }}</div>
          <div class="stat-value">{{ stat.value }}</div>
          <div class="stat-change" [ngClass]="stat.changeClass">
            <span class="change-arrow" *ngIf="stat.changeClass === 'positive'">‚Üó</span>
            <span class="change-arrow" *ngIf="stat.changeClass === 'negative'">‚Üò</span>
            <span>{{ stat.change }}</span>
          </div>
        </div>
        <div class="stat-icon" [ngClass]="stat.iconClass">{{ stat.icon }}</div>
      </div>
    </div>
  </div>

  <!-- Dashboard Grid -->
  <div class="dashboard-grid">

    <!-- Main Panel -->
    <div class="main-panel">

      <!-- Recent Orders -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Recent Orders</h2>
          <button class="view-all-btn" (click)="goTo('/seller-dashboard/orders')">View All Orders</button>
        </div>
        <div class="table-container">
          <div *ngIf="recentOrders.length === 0" class="empty-state">
            <p>No orders found</p>
            <small>Your recent orders will appear here</small>
          </div>
          <table class="orders-table" *ngIf="recentOrders.length > 0">
            <thead>
              <tr>
                <th>Order ID</th><th>Customer</th><th>Items</th>
                <th>Amount</th><th>Status</th><th>Date</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let order of recentOrders"
                  (click)="goTo('/seller-dashboard/orders/' + order.id)" style="cursor:pointer">
                <td><span class="order-id">#{{ order.id }}</span></td>
                <td>{{ order.customer }}</td>
                <td>{{ order.product }}</td>
                <td>{{ order.amount }}</td>
                <td><span class="status-badge" [ngClass]="order.statusClass">{{ order.status }}</span></td>
                <td>{{ order.date }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Sales chart -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Sales Overview</h2>
        </div>
        <div class="chart-container">
          <ng-container *ngIf="analyticsData?.revenue?.monthlyTrend && analyticsData.revenue.monthlyTrend.length > 0; else noChart">
            <div style="display:flex;align-items:flex-end;gap:0.5rem;height:260px;width:100%;">
              <div *ngFor="let d of analyticsData.revenue.monthlyTrend"
                   style="flex:1;display:flex;flex-direction:column;align-items:center;gap:0.5rem;height:100%;justify-content:flex-end;">
                <div class="bar revenue-bar"
                     [style.height.px]="(d.revenue / 10000) * 2"
                     style="width:100%;border-radius:4px 4px 0 0;min-height:4px;"></div>
                <span style="font-size:0.75rem;color:#6b7280;">{{ d.month }}</span>
              </div>
            </div>
          </ng-container>
          <ng-template #noChart>
            üìà Sales Chart<br>
            <small>Sales data will appear here once you have orders</small>
          </ng-template>
        </div>
      </div>

    </div><!-- /main-panel -->

    <!-- Sidebar -->
    <div class="sidebar-panel">

      <!-- Quick Actions -->
      <div class="card">
        <div class="card-header"><h3 class="card-title">Quick Actions</h3></div>
        <div class="quick-actions">
          <button *ngFor="let a of quickActions" class="quick-action-btn" (click)="goTo(a.path)">
            <div class="action-icon">{{ a.icon }}</div>
            <span class="action-text">{{ a.text }}</span>
          </button>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="card">
        <div class="card-header"><h3 class="card-title">Recent Activity</h3></div>
        <div class="activity-list">
          <div *ngIf="activities.length === 0" class="empty-state">
            <p>No recent activity</p>
            <small>Your activities will appear here</small>
          </div>
          <div class="activity-item" *ngFor="let a of activities">
            <div class="activity-icon" [ngClass]="a.iconClass">{{ a.icon }}</div>
            <div class="activity-content">
              <div class="activity-text">{{ a.text }}</div>
              <div class="activity-time">{{ a.time }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Store Performance -->
      <div class="card">
        <div class="card-header"><h3 class="card-title">Store Performance</h3></div>
        <div style="display:flex;flex-direction:column;gap:1rem;">
          <div *ngFor="let m of performanceMetrics"
               style="display:flex;justify-content:space-between;align-items:center;">
            <span style="color:#6b7280;">{{ m.label }}</span>
            <span style="font-weight:600;" [ngClass]="m.valueClass ?? ''">{{ m.value }}</span>
          </div>
          <button class="btn btn-primary"
                  style="width:100%;justify-content:center;margin-top:1rem;"
                  (click)="goTo('/seller-dashboard/analytics')">
            üìä View Detailed Analytics
          </button>
        </div>
      </div>

    </div><!-- /sidebar-panel -->

  </div><!-- /dashboard-grid -->
</div>