<!-- analytics.component.html -->
<div class="page-header">
  <button class="back-btn" (click)="router.navigate(['/seller-dashboard/overview'])">‚Üê Back to Dashboard</button>
  <h1 class="page-title">Analytics & Reports</h1>
</div>

<div *ngIf="isLoading" class="loading-container">
  <div class="loading-spinner"></div><p>Loading analytics...</p>
</div>

<div *ngIf="error && !isLoading" class="error-container">
  <div class="error-message">
    <span class="error-icon">‚ö†Ô∏è</span><p>{{ error }}</p>
    <button class="btn btn-primary" (click)="load()">Retry</button>
  </div>
</div>

<div class="analytics-grid" *ngIf="!isLoading && data">

  <!-- Sales Trend -->
  <div class="card analytics-card">
    <div class="card-header"><h3 class="card-title">Sales Trend</h3></div>
    <div class="chart-container">
      <div *ngIf="data.revenue.monthlyTrend.length > 0"
           style="display:flex;align-items:flex-end;gap:0.5rem;height:260px;width:100%;">
        <div *ngFor="let d of data.revenue.monthlyTrend"
             style="flex:1;display:flex;flex-direction:column;align-items:center;gap:0.5rem;height:100%;justify-content:flex-end;">
          <span style="font-size:0.75rem;font-weight:600;color:#1f2937;">{{ formatCurrency(d.revenue) }}</span>
          <div class="bar revenue-bar" [style.height.px]="(d.revenue / 10000) * 2"
               style="width:100%;border-radius:4px 4px 0 0;min-height:4px;"></div>
          <span style="font-size:0.75rem;color:#6b7280;">{{ d.month }}</span>
        </div>
      </div>
      <div *ngIf="data.revenue.monthlyTrend.length === 0">üìà Sales trend data will appear here</div>
    </div>
  </div>

  <!-- Top Selling Products -->
  <div class="card analytics-card">
    <div class="card-header"><h3 class="card-title">Top Selling Products</h3></div>
    <div *ngIf="data.topProducts.length === 0" class="empty-state"><p>No product sales data yet</p></div>
    <table class="data-table" *ngIf="data.topProducts.length > 0">
      <thead><tr><th>#</th><th>Product</th><th>Units Sold</th><th>Revenue</th></tr></thead>
      <tbody>
        <tr *ngFor="let product of data.topProducts; let i = index">
          <td><span class="rank-badge" [class.top-rank]="i < 3">{{ i + 1 }}</span></td>
          <td>{{ product.name }}</td>
          <td>{{ product.sales }}</td>
          <td>{{ formatCurrency(product.revenue) }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Customer Statistics -->
  <div class="card analytics-card">
    <div class="card-header"><h3 class="card-title">Customer Statistics</h3></div>
    <div style="display:flex;flex-direction:column;gap:1rem;">
      <div style="display:flex;justify-content:space-between;">
        <span style="color:#6b7280;">Total Orders</span>
        <span style="font-size:1.5rem;font-weight:700;">{{ data.orders.total }}</span>
      </div>
      <div style="display:flex;justify-content:space-between;">
        <span style="color:#6b7280;">Customer Satisfaction</span>
        <span style="font-size:1.5rem;font-weight:700;">{{ data.customerStats.customerSatisfaction.toFixed(1) }}/5.0</span>
      </div>
      <div style="display:flex;justify-content:space-between;">
        <span style="color:#6b7280;">Average Rating</span>
        <span style="font-size:1.5rem;font-weight:700;">‚≠ê {{ data.reviews.averageRating }}/5</span>
      </div>
    </div>
  </div>

  <!-- Monthly Revenue (full width) -->
  <div class="card analytics-card" style="grid-column:1/-1;">
    <div class="card-header"><h3 class="card-title">Monthly Revenue</h3></div>
    <div class="chart-container">
      <div *ngIf="data.revenue.monthlyTrend.length > 0"
           style="display:flex;align-items:flex-end;gap:0.5rem;height:260px;width:100%;">
        <div *ngFor="let d of data.revenue.monthlyTrend"
             style="flex:1;display:flex;flex-direction:column;align-items:center;gap:0.5rem;height:100%;justify-content:flex-end;">
          <div class="bar revenue-bar" [style.height.px]="(d.revenue / 10000) * 2"
               style="width:100%;border-radius:4px 4px 0 0;min-height:4px;"></div>
          <span style="font-size:0.75rem;color:#6b7280;">{{ d.month }}</span>
        </div>
      </div>
      <div *ngIf="data.revenue.monthlyTrend.length === 0">üìà Revenue trend will appear here</div>
    </div>
  </div>

  <!-- Order Breakdown -->
  <div class="card analytics-card">
    <div class="card-header"><h3 class="card-title">Order Breakdown</h3></div>
    <div style="display:flex;flex-direction:column;gap:0.75rem;">
      <div style="display:flex;justify-content:space-between;"><span style="color:#6b7280;">Pending</span><span class="status-badge pending">{{ data.orders.pending }}</span></div>
      <div style="display:flex;justify-content:space-between;"><span style="color:#6b7280;">Processing</span><span class="status-badge processing">{{ data.orders.processing }}</span></div>
      <div style="display:flex;justify-content:space-between;"><span style="color:#6b7280;">Shipped</span><span class="status-badge processing">{{ data.orders.shipped }}</span></div>
      <div style="display:flex;justify-content:space-between;"><span style="color:#6b7280;">Delivered</span><span class="status-badge delivered">{{ data.orders.delivered }}</span></div>
      <div style="display:flex;justify-content:space-between;"><span style="color:#6b7280;">Cancelled</span><span class="status-badge cancelled">{{ data.orders.cancelled }}</span></div>
    </div>
  </div>

  <!-- Product Inventory -->
  <div class="card analytics-card">
    <div class="card-header"><h3 class="card-title">Product Inventory</h3></div>
    <div style="display:flex;flex-direction:column;gap:0.75rem;">
      <div style="display:flex;justify-content:space-between;"><span style="color:#6b7280;">Total Products</span><span style="font-weight:700;">{{ data.products.total }}</span></div>
      <div style="display:flex;justify-content:space-between;"><span style="color:#6b7280;">In Stock</span><span class="stock-good">{{ data.products.inStock }}</span></div>
      <div style="display:flex;justify-content:space-between;"><span style="color:#6b7280;">Out of Stock</span><span class="stock-low">{{ data.products.outOfStock }}</span></div>
      <div *ngIf="data.products.lowStock.length > 0">
        <hr style="border:none;border-top:1px solid #e5e7eb;margin:0.5rem 0;">
        <p style="font-size:0.85rem;font-weight:600;color:#d97706;margin-bottom:0.5rem;">‚ö† Low Stock Alert</p>
        <div *ngFor="let p of data.products.lowStock.slice(0, 5)"
             style="display:flex;justify-content:space-between;font-size:0.85rem;margin-bottom:0.25rem;">
          <span style="color:#374151;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:70%;">{{ p.title }}</span>
          <span class="stock-low">{{ p.stock }} left</span>
        </div>
      </div>
    </div>
  </div>

</div>